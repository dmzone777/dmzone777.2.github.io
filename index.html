<!DOCTYPE html>
<html>
<head>
  <title>Mini Instagram</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<h2>Mini Instagram ðŸš€</h2>

<!-- Login -->
<input type="email" id="email" placeholder="Email"><br><br>
<input type="password" id="password" placeholder="Password"><br><br>

<button onclick="signup()">Sign Up</button>
<button onclick="login()">Login</button>

<hr>

<!-- Upload -->
<input type="file" id="fileInput"><br><br>
<button onclick="uploadImage()">Upload</button>

<hr>

<div id="gallery"></div>

<script type="module">

// ðŸ”¥ Firebase
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDcZnUuqjD7lDHLj65V-f3E75w4DsSFQ1s",
  authDomain: "mini-instagram-2.firebaseapp.com",
  projectId: "mini-instagram-2",
  storageBucket: "mini-instagram-2.firebasestorage.app",
  messagingSenderId: "974084882408",
  appId: "1:974084882408:web:71d08fb5c20cd80440ee5d",
  measurementId: "G-9B8M8C72R2"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// ðŸ”¥ Supabase
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabaseUrl = "https://hotvdwvahuotmkrzqlvw.supabase.co";
const supabaseKey = "sb_publishable_Tpu98ldCavcAtSbMDKmm4Q_3P4JWGdj";

const supabase = createClient(supabaseUrl, supabaseKey);

// Sign Up
window.signup = async function(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  await createUserWithEmailAndPassword(auth, email, password);
  alert("Account Created âœ…");
}

// Login
window.login = async function(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  await signInWithEmailAndPassword(auth, email, password);
  alert("Login Success âœ…");
}

// Upload Image
window.uploadImage = async function(){

  const file = document.getElementById("fileInput").files[0];

  if(!file){
    alert("Select file first");
    return;
  }

  const fileName = Date.now() + "-" + file.name;

  const { error } = await supabase.storage
    .from("images")
    .upload(fileName, file);

  if(error){
    alert(error.message);
    return;
  }

  const { data } = supabase
    .storage
    .from("images")
    .getPublicUrl(fileName);

  const imageUrl = data.publicUrl;

  document.getElementById("gallery").innerHTML +=
    `<img src="${imageUrl}" width="100%" style="margin-bottom:10px;">`;

  alert("Upload Successful ðŸš€");
}

</script>

</body>
</html>